{"version":3,"sources":["webpack://qjmind/webpack/universalModuleDefinition","webpack://qjmind/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://qjmind/./src/mind.js","webpack://qjmind/webpack/bootstrap","webpack://qjmind/webpack/runtime/define property getters","webpack://qjmind/webpack/runtime/hasOwnProperty shorthand","webpack://qjmind/webpack/runtime/make namespace object","webpack://qjmind/./index.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","isValueNull","val","undefined","qjm","opts","fn","canvas_container","canvas","ctx","ratio","scale","canvas_center_pos","all_node_pos_map","mind","init","render","data","node_json","create_mind","add_event","document","querySelector","container","createElement","appendChild","getContext","w","offsetWidth","h","offsetHeight","width","height","style","devicePixelRatio","window","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","getCanvasCenterPos","translate","x","y","Mind","clearCanvas","cT","getTransform","matrix","a","b","c","d","e","f","lt","_getXY","rb","clearRect","changeLayout","add_event_zoom","add_event_dragmove","add_event_click","addEventListener","event","ctrlKey","metaKey","preventDefault","passive","zoom","stopPropagation","deltaY","offsetX","offsetY","requestAnimationFrame","show_view","t","isDown","_mousemove","clientX","clientY","_mouseup","cursor","removeEventListener","newxy","ex","ey","all_nodes","i","length","p","keyNodeClick","type","Math","pow","expanded_l","expanded_r","expanded","mouseX","mouseY","newX","newY","util","throttle","wait","timer","setTimeout","apply","arguments","clearTimeout","newid","Date","getTime","toString","random","substr","deepClone","objClone","Array","isArray","Object","key","hasOwnProperty","flatArray","arr","concat","arr1","forEach","item","push","KeyNode","objectiveId","text","shape","keyNode_w","keyNode_h","hub_radius","line_color","child_index","rank_index","direction","isRoot","parent","children","children_count_l","children_count_r","hubPos_l","hubPos_r","hubPos","children_count","show","getHubPos","drawKeyNode","drawContent","set_mind_pos_map","node_pos","map","save","beginPath","fillStyle","shadowBlur","shadowColor","fillRect","fill","restore","_drawText","str","fontsize","lineHeight","textAlign","currSumWidth","lineNum","fillText","measureText","_drawCircle","left","top","r","centerText","bgcolor","arc","PI","closePath","_drawRect","x0","y0","shapeobj","background","textobj","font","color","textBaseline","value","drawLine_to_child","moveTo","strokeStyle","lineTo","stroke","drawHub","drawLine_to_parent","moveToX","moveToY","quadraticCurveTo","pos","child_len","_drawHub","get_children_nodes","dir","filter","canvas_center","nodes","nodes_flat_array","expanded_node_group","total_height","total_max_node_length","get_nodes","get_expanded_node_group","get_group_max_length","layout","_parse","parent_node","parent_node_json","node","add_node","index","child_node_json","child_node","id","_draw_nodes","_draw_lines","group","group_info","group_index","expanded_rank_max_l","expanded_rank_max_r","expanded_nodes_l","expanded_nodes_r","_rank","rankid","children_l","children_r","j","isEmpty","slice","node_length_l","node_length_r","max_node_length","max","max_side_direction","_get_total_height","bottom","top_y","center_pos","rank_max_nodes_length_l","rank_max_nodes_length_r","_layout_backward","_layout_forward","expanded_nodes","group_center_pos","expanded_rank_max","rank_max_nodes","rank_max_nodes_total_height","top_h","curr_rank_nodes","next_rank_nodes","curr_rank_nodes_flat","y1","diff","QjMind"],"mappings":"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","file":"main.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"qjmind\"] = factory();\n\telse\n\t\troot[\"qjmind\"] = factory();\n})(self, function() {\nreturn ","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","const isValueNull = function (val) {\n  return val === \"\" || val === null || val === undefined;\n};\n\nvar qjm = function (opts, fn) {\n  this.opts = opts;\n  this.fn = fn;\n  this.canvas_container = null;\n  this.canvas = null;\n  this.ctx = null;\n  this.ratio = null;\n  this.scale = 0.8;\n  this.canvas_center_pos = {};\n  this.all_node_pos_map = {};\n  this.mind = null;\n\n  this.init();\n};\nqjm.prototype = {\n  render(data) {\n    this.node_json = data;\n    this.create_mind();\n    this.add_event();\n  },\n  init() {\n    this.canvas_container = document.querySelector(this.opts.container);\n    this.canvas = document.createElement(\"canvas\");\n    this.canvas_container.appendChild(this.canvas);\n    this.ctx = this.canvas.getContext(\"2d\");\n\n    var w = this.canvas_container.offsetWidth;\n    var h = this.canvas_container.offsetHeight;\n    this.canvas.width = w;\n    this.canvas.height = h;\n    this.canvas.style.width = w + \"px\";\n    this.canvas.style.height = h + \"px\";\n\n    // 屏幕的设备像素比\n    var devicePixelRatio = window.devicePixelRatio || 1;\n    // 浏览器在渲染canvas之前存储画布信息的像素比\n    var backingStoreRatio =\n      this.ctx.webkitBackingStorePixelRatio ||\n      this.ctx.mozBackingStorePixelRatio ||\n      this.ctx.msBackingStorePixelRatio ||\n      this.ctx.oBackingStorePixelRatio ||\n      this.ctx.backingStorePixelRatio ||\n      1;\n    // canvas的实际渲染倍率\n    this.ratio = devicePixelRatio / backingStoreRatio;\n    this.canvas.width *= this.ratio;\n    this.canvas.height *= this.ratio;\n    this.canvas_center_pos = this.getCanvasCenterPos();\n    this.ctx.scale(this.ratio, this.ratio);\n    // 初始化缩放\n    this.ctx.translate(this.canvas_center_pos.x, this.canvas_center_pos.y);\n    this.ctx.scale(this.scale, this.scale);\n    this.ctx.translate(-this.canvas_center_pos.x, -this.canvas_center_pos.y);\n  },\n  create_mind() {\n    this.mind = new qjm.Mind(this, this.opts, this.node_json);\n  },\n  clearCanvas() {\n    // 矩阵换算鼠标点击位置对应的新坐标\n    var cT = this.ctx.getTransform();\n    let matrix = [cT.a, cT.b, cT.c, cT.d, cT.e, cT.f];\n    var lt = this._getXY(matrix, 0, 0);\n    var rb = this._getXY(\n      matrix,\n      this.canvas_container.offsetWidth,\n      this.canvas_container.offsetHeight\n    );\n    this.ctx.clearRect(lt.x, lt.y, rb.x - lt.x, rb.y - lt.y);\n  },\n  changeLayout() {\n    this.clearCanvas();\n    this.mind.init();\n  },\n  // 计算画布中心\n  getCanvasCenterPos() {\n    return {\n      x: this.canvas.width / this.ratio / 2,\n      y: this.canvas.height / this.ratio / 2,\n    };\n  },\n  add_event() {\n    this.add_event_zoom();\n    this.add_event_dragmove();\n    this.add_event_click();\n  },\n  add_event_zoom() {\n    // 禁用原生页面缩放\n    window.addEventListener(\n      \"mousewheel\",\n      function (event) {\n        if (event.ctrlKey === true || event.metaKey) {\n          event.preventDefault();\n        }\n      },\n      { passive: false }\n    );\n    //firefox\n    window.addEventListener(\n      \"DOMMouseScroll\",\n      function (event) {\n        if (event.ctrlKey === true || event.metaKey) {\n          event.preventDefault();\n        }\n      },\n      { passive: false }\n    );\n    // canvas缩放\n    this.canvas.addEventListener(\"wheel\", (e) => {\n      let zoom = 1;\n      e.stopPropagation();\n      e.preventDefault();\n      if (e.ctrlKey) {\n        if (e.deltaY > 0) zoom = 0.95;\n        if (e.deltaY < 0) zoom = 1.05;\n        if (this.scale * zoom > 1.1 || this.scale * zoom < 0.5) return;\n        this.scale *= zoom;\n\n        this.clearCanvas();\n        this.ctx.translate(e.offsetX, e.offsetY);\n        this.ctx.scale(zoom, zoom);\n        this.ctx.translate(-e.offsetX, -e.offsetY);\n\n        requestAnimationFrame(() => {\n          this.mind.show_view();\n        });\n      }\n    });\n  },\n  add_event_dragmove() {\n    var t = this;\n    var canvas = this.canvas;\n    var isDown = false;\n    var x, y;\n    function _mousemove(e) {\n      if (!isDown) return;\n      t.clearCanvas();\n      t.ctx.translate((e.clientX - x) / t.scale, (e.clientY - y) / t.scale);\n      requestAnimationFrame(() => {\n        t.mind.show_view();\n      });\n      x = e.clientX;\n      y = e.clientY;\n      return false;\n    }\n    function _mouseup(e) {\n      //开关关闭\n      canvas.style.cursor = \"default\";\n      canvas.removeEventListener(\"mousemove\", _mousemove);\n      canvas.removeEventListener(\"mouseup\", _mouseup);\n      isDown = false;\n    }\n    canvas.addEventListener(\"mousedown\", (e) => {\n      //获取x坐标和y坐标\n      x = e.clientX;\n      y = e.clientY;\n      //开关打开\n      isDown = true;\n      canvas.style.cursor = \"grabbing\";\n      canvas.addEventListener(\"mousemove\", _mousemove);\n      canvas.addEventListener(\"mouseup\", _mouseup);\n      return false;\n    });\n  },\n  add_event_click() {\n    var canvas = this.canvas;\n    var ctx = this.ctx;\n    canvas.addEventListener(\"click\", (e) => {\n      // 矩阵换算鼠标点击位置对应的新坐标\n      var cT = ctx.getTransform();\n      let matrix = [cT.a, cT.b, cT.c, cT.d, cT.e, cT.f];\n      var newxy = this._getXY(matrix, e.offsetX, e.offsetY);\n      var ex = newxy.x;\n      var ey = newxy.y;\n\n      var all_nodes = this.all_node_pos_map;\n      // 点击内容节点\n      for (var i = 0; i < all_nodes[\"keynode\"].length; i++) {\n        let p = all_nodes[\"keynode\"][i];\n        if (\n          p.x - p.width / 2 <= ex &&\n          ex <= p.x + p.width / 2 &&\n          p.y - p.height / 2 <= ey &&\n          ey <= p.y + p.height / 2\n        ) {\n          // console.log(\"点击了keynode:\" + p.content, p.x, p.y);\n          this.fn.keyNodeClick && this.fn.keyNodeClick(p);\n          return;\n        }\n      }\n      // 点击分支桥接节点\n      for (var type in all_nodes) {\n        if (type == \"keynode\") continue;\n        for (var i = 0; i < all_nodes[type].length; i++) {\n          let p = all_nodes[type][i];\n          if (\n            Math.pow(ex - p[type][0], 2) + Math.pow(ey - p[type][1], 2) <\n            100\n          ) {\n            // console.log(`点击了${p.content}的hub节点${type}`);\n            if (type == \"hubPos_l\") p.expanded_l = !p.expanded_l;\n            if (type == \"hubPos_r\") p.expanded_r = !p.expanded_r;\n            if (type == \"hubPos\") p.expanded = !p.expanded;\n            this.changeLayout();\n            return;\n          }\n        }\n      }\n    });\n  },\n  // 矩阵换算\n  _getXY(matrix, mouseX, mouseY) {\n    var newX = (mouseX * this.ratio - matrix[4]) / matrix[0];\n    var newY = (mouseY * this.ratio - matrix[5]) / matrix[3];\n    return { x: newX, y: newY };\n  },\n};\n\nqjm.util = {\n  throttle(fn, wait) {\n    let timer;\n    return function () {\n      if (!timer) {\n        timer = setTimeout(() => {\n          fn.apply(this, arguments);\n          clearTimeout(timer);\n          timer = null;\n        }, wait);\n      }\n    };\n  },\n  newid() {\n    return (\n      new Date().getTime().toString(16) + Math.random().toString(16).substr(2)\n    ).substr(2, 16);\n  },\n  deepClone(obj) {\n    let objClone = Array.isArray(obj) ? [] : obj instanceof Object ? {} : obj;\n    if (obj && obj instanceof Array) {\n      for (let i = 0; i < obj.length; i++) {\n        if (obj[i]) {\n          objClone[i] = qjm.util.deepClone(obj[i]);\n        }\n      }\n    } else if (obj && obj instanceof Object) {\n      for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          if (obj[key] && typeof obj[key] === \"object\") {\n            objClone[key] = qjm.util.deepClone(obj[key]);\n          } else {\n            objClone[key] = obj[key];\n          }\n        }\n      }\n    }\n    return objClone;\n  },\n  flatArray(arr) {\n    arr = [].concat(arr);\n    let arr1 = [];\n    arr.forEach((item) => {\n      if (item instanceof Array) {\n        arr1 = arr1.concat(qjm.util.flatArray(item));\n      } else {\n        arr1.push(item);\n      }\n    });\n    return arr1;\n  },\n};\n\n// 节点构造函数\nqjm.KeyNode = function (qjm, node_json) {\n  this.qjm = qjm;\n  this.objectiveId = node_json.objectiveId || 0;\n  this.text = node_json.text;\n  this.shape = node_json.shape;\n  this.x = node_json.x;\n  this.y = node_json.y;\n  this.width = qjm.opts.keyNode_w || 320;\n  this.height = qjm.opts.keyNode_h || 100;\n  this.hub_radius = qjm.opts.hub_radius || 10;\n  this.line_color = qjm.opts.line_color || \"#e3e4e5\";\n\n  this.child_index = node_json.child_index;\n  this.rank_index = node_json.rank_index;\n  this.direction = node_json.direction;\n  this.isRoot = node_json.isRoot;\n  this.parent = null;\n  this.children = node_json.children;\n\n  if (this.isRoot) {\n    this.expanded_l = node_json.expanded_l;\n    this.expanded_r = node_json.expanded_r;\n    this.children_count_l = node_json.children_count_l;\n    this.children_count_r = node_json.children_count_r;\n    this.hubPos_l = null;\n    this.hubPos_r = null;\n  } else {\n    this.hubPos = null;\n    this.expanded = node_json.expanded;\n    this.children_count = node_json.children_count;\n  }\n};\nqjm.KeyNode.prototype = {\n  show() {\n    this.getHubPos();\n    this.drawKeyNode();\n    this.drawContent();\n  },\n  set_mind_pos_map(type, node_pos) {\n    var map = this.qjm.all_node_pos_map;\n    if (!map[type]) map[type] = [];\n    map[type].push(node_pos);\n  },\n  drawKeyNode() {\n    var ctx = this.qjm.ctx;\n    if (isValueNull(this.x) || isValueNull(this.y)) {\n      return;\n    }\n    ctx.save();\n    ctx.beginPath();\n    ctx.fillStyle = \"#ffffff\";\n    ctx.shadowBlur = 10;\n    ctx.shadowColor = \"rgba(31,35,41,0.08)\";\n\n    ctx.fillRect(\n      this.x - this.width / 2,\n      this.y - this.height / 2,\n      this.width,\n      this.height\n    );\n    ctx.fill();\n    ctx.restore();\n\n    this.set_mind_pos_map(\"keynode\", this);\n  },\n  _drawText(str, x, y, w, h, fontsize, lineHeight, textAlign) {\n    var ctx = this.qjm.ctx;\n    ctx.textAlign = textAlign || \"left\";\n    var currSumWidth = 0;\n    var lineNum = 1;\n    for (let i = 0; i < str.length; i++) {\n      ctx.fillText(str[i], x + currSumWidth, y);\n      currSumWidth += ctx.measureText(str[i]).width;\n      if (i === str.length - 1) return;\n      if (currSumWidth + ctx.measureText(str[i + 1]).width > w) {\n        if (lineHeight * (lineNum + 1) > h) {\n          ctx.fillText(\"...\", x + currSumWidth, y);\n          return;\n        }\n        y += lineHeight;\n        lineNum += 1;\n        currSumWidth = 0;\n      }\n    }\n  },\n  _drawCircle(left, top, r, centerText, bgcolor) {\n    var ctx = this.qjm.ctx;\n    ctx.save();\n    ctx.beginPath();\n    ctx.arc(left, top, r, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fillStyle = bgcolor;\n    ctx.fill();\n    ctx.restore();\n  },\n  _drawRect(left, top, w, h, bgcolor) {\n    var ctx = this.qjm.ctx;\n    ctx.save();\n    ctx.fillStyle = bgcolor;\n    ctx.fillRect(left, top, w, h);\n    ctx.restore();\n  },\n  drawContent() {\n    var ctx = this.qjm.ctx;\n    var x0 = this.x - this.width / 2;\n    var y0 = this.y - this.height / 2;\n    // 画头像\n    for (var i = 0; i < this.shape.length; i++) {\n      var shapeobj = this.shape[i];\n      if (shapeobj.type == \"circle\") {\n        this._drawCircle(\n          x0 + shapeobj.left,\n          y0 + shapeobj.top,\n          shapeobj.r,\n          shapeobj.text,\n          shapeobj.background\n        );\n      } else {\n        this._drawRect(\n          x0 + shapeobj.left,\n          y0 + shapeobj.top,\n          shapeobj.width,\n          shapeobj.height,\n          shapeobj.background\n        );\n      }\n    }\n    // 姓名+部门名\n    for (var i = 0; i < this.text.length; i++) {\n      var textobj = this.text[i];\n      ctx.save();\n      ctx.font = textobj.fontsize + \"px April\";\n      ctx.fillStyle = textobj.color;\n      ctx.textBaseline = \"top\";\n      this._drawText(\n        textobj.value,\n        x0 + textobj.left,\n        y0 + textobj.top,\n        textobj.width,\n        textobj.height,\n        textobj.fontsize,\n        textobj.lineHeight,\n        textobj.textAlign\n      );\n      ctx.restore();\n    }\n  },\n  drawLine_to_child() {\n    var ctx = this.qjm.ctx;\n    ctx.save();\n    if (this.isRoot) {\n      if (this.children_count_r) {\n        ctx.beginPath();\n        ctx.moveTo(this.x + (1 * this.width) / 2, this.y);\n        ctx.strokeStyle = this.line_color;\n        ctx.lineTo(this.hubPos_r[0], this.hubPos_r[1]);\n        ctx.closePath();\n        ctx.stroke();\n        ctx.restore();\n        this.drawHub(this.hubPos_r, this.children_count_r);\n      }\n      if (this.children_count_l) {\n        ctx.beginPath();\n        ctx.moveTo(this.x + (-1 * this.width) / 2, this.y);\n        ctx.strokeStyle = this.line_color;\n        ctx.lineTo(this.hubPos_l[0], this.hubPos_l[1]);\n        ctx.closePath();\n        ctx.stroke();\n        this.drawHub(this.hubPos_l, this.children_count_l);\n      }\n    } else {\n      ctx.beginPath();\n      ctx.moveTo(this.x + (this.direction * this.width) / 2, this.y);\n      ctx.strokeStyle = this.line_color;\n      ctx.lineTo(this.hubPos[0], this.hubPos[1]);\n      ctx.closePath();\n      ctx.stroke();\n      ctx.restore();\n      this.drawHub(this.hubPos, this.children_count);\n    }\n  },\n  drawLine_to_parent() {\n    var ctx = this.qjm.ctx;\n    ctx.save();\n    ctx.beginPath();\n    var moveToX = this.x - (this.direction * this.width) / 2;\n    var moveToY = this.y;\n    ctx.moveTo(moveToX, moveToY);\n    ctx.strokeStyle = this.line_color;\n    if (this.parent.isRoot) {\n      this.direction === 1 &&\n        ctx.quadraticCurveTo(\n          moveToX - 50,\n          moveToY,\n          this.parent.hubPos_r[0],\n          this.parent.hubPos_r[1]\n        );\n      this.direction === -1 &&\n        ctx.quadraticCurveTo(\n          moveToX + 50,\n          moveToY,\n          this.parent.hubPos_l[0],\n          this.parent.hubPos_l[1]\n        );\n    } else {\n      ctx.quadraticCurveTo(\n        this.direction === 1 ? moveToX - 50 : moveToX + 50,\n        moveToY,\n        this.parent.hubPos[0],\n        this.parent.hubPos[1]\n      );\n    }\n    ctx.stroke();\n    ctx.restore();\n  },\n  drawHub(pos, child_len) {\n    if (this.isRoot) {\n      if (this.children_count_r) {\n        this._drawHub(this.hubPos_r, this.children_count_r);\n        this.set_mind_pos_map(\"hubPos_r\", this);\n      }\n      if (this.children_count_l) {\n        this._drawHub(this.hubPos_l, this.children_count_l);\n        this.set_mind_pos_map(\"hubPos_l\", this);\n      }\n    } else {\n      if (this.children_count) {\n        this._drawHub(this.hubPos, this.children_count);\n        this.set_mind_pos_map(\"hubPos\", this);\n      }\n    }\n  },\n  _drawHub(pos, child_len) {\n    var ctx = this.qjm.ctx;\n    ctx.save();\n    ctx.fillStyle = \"#ffffff\";\n    ctx.shadowBlur = 6;\n    ctx.shadowColor = \"rgba(31,35,41,0.08)\";\n    ctx.beginPath();\n    ctx.arc(pos[0], pos[1], this.hub_radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n    ctx.restore();\n\n    if (child_len > 0) {\n      ctx.save();\n      ctx.fillStyle = \"#000000\";\n      ctx.font = \"30px\";\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillText(child_len, pos[0], pos[1]);\n      ctx.restore();\n    }\n  },\n  getHubPos() {\n    if (this.isRoot) {\n      this.hubPos_l = [this.x + -1 * (this.width / 2 + 40), this.y];\n      this.hubPos_r = [this.x + 1 * (this.width / 2 + 40), this.y];\n    } else {\n      this.hubPos = [this.x + this.direction * (this.width / 2 + 40), this.y];\n    }\n  },\n  get_children_nodes(dir) {\n    return this.children.filter((item) => item.direction === dir);\n  },\n};\n\n// 树图构造函数\nqjm.Mind = function (qjm, opts, node_json) {\n  this.qjm = qjm;\n  this.opts = opts;\n  this.canvas_center = null;\n  this.node_json = [].concat(node_json);\n  this.nodes = [];\n  this.nodes_flat_array = [];\n  this.expanded_node_group = [];\n  this.total_height = 0;\n  this.total_max_node_length = 0;\n\n  this.get_nodes();\n  this.init();\n};\nqjm.Mind.prototype = {\n  init() {\n    this.canvas_center = this.qjm.getCanvasCenterPos();\n    this.get_expanded_node_group();\n    this.get_group_max_length();\n    this.layout(); //给每个节点赋值xy坐标值\n    this.show_view();\n  },\n  get_nodes() {\n    for (var i = 0; i < this.node_json.length; i++) {\n      this.nodes.push(this._parse(this.node_json[i]));\n    }\n  },\n  _parse(node_json, parent_node, parent_node_json) {\n    node_json.x = null;\n    node_json.y = null;\n\n    let node = this.add_node(node_json);\n    node.parent = parent_node;\n    if (node_json.children) {\n      node.children = [];\n      for (let index = 0; index < node_json.children.length; index++) {\n        let child_node_json = node_json.children[index];\n        child_node_json.child_index = index;\n\n        let child_node = this._parse(child_node_json, node, node_json);\n        node.children.push(child_node);\n      }\n    }\n    return node;\n  },\n\n  add_node(node_json) {\n    let node = new qjm.KeyNode(this.qjm, node_json);\n    node.id = qjm.util.newid();\n    this.nodes_flat_array.push(node);\n    return node;\n  },\n\n  show_view() {\n    for (var i = 0; i < this.nodes.length; i++) {\n      this._draw_nodes(this.nodes[i]);\n      this._draw_lines(this.nodes[i]);\n      //TODO:每组的间隔\n    }\n  },\n  _draw_nodes(node) {\n    if (node.parent && node.parent.isRoot) {\n      if (node.direction === -1 && !node.parent.expanded_l) return;\n      if (node.direction === 1 && !node.parent.expanded_r) return;\n    }\n    if (node.parent && !node.parent.isRoot) {\n      if (!node.parent.expanded) return;\n    }\n    node.show();\n    if (node.children) {\n      for (let index = 0; index < node.children.length; index++) {\n        let child_node = node.children[index];\n        this._draw_nodes(child_node);\n      }\n    }\n  },\n  _draw_lines(node) {\n    if (node.parent && node.parent.isRoot) {\n      if (node.direction === -1 && !node.parent.expanded_l) return;\n      if (node.direction === 1 && !node.parent.expanded_r) return;\n    }\n    if (node.parent && !node.parent.isRoot) {\n      if (!node.parent.expanded) return;\n    }\n    if (node.parent) {\n      node.drawLine_to_parent();\n    }\n    if (node.children.length) {\n      node.drawLine_to_child();\n      for (let index = 0; index < node.children.length; index++) {\n        let child_node = node.children[index];\n        this._draw_lines(child_node);\n      }\n      node.drawHub();\n    }\n  },\n\n  get_expanded_node_group() {\n    var t = this;\n    var group = [];\n    for (var i = 0; i < t.nodes.length; i++) {\n      var group_info = {\n        group_index: i,\n        expanded_rank_max_l: 0,\n        expanded_rank_max_r: 0,\n        expanded_nodes_l: [],\n        expanded_nodes_r: [],\n      };\n      group_info.expanded_nodes_l[0] = t.nodes[i];\n      group_info.expanded_nodes_r[0] = t.nodes[i];\n\n      (function _rank(obj, rankid) {\n        obj.rank_index = rankid;\n        group_info.expanded_rank_max_r =\n          obj.direction === 1 && rankid > group_info.expanded_rank_max_r\n            ? rankid\n            : group_info.expanded_rank_max_r;\n        group_info.expanded_rank_max_l =\n          obj.direction === -1 && rankid > group_info.expanded_rank_max_l\n            ? rankid\n            : group_info.expanded_rank_max_l;\n\n        // 有展开的子元素，则给下一级push进去他的所有子元素数组\n        if (!group_info.expanded_nodes_l[rankid + 1])\n          group_info.expanded_nodes_l[rankid + 1] = [];\n        if (!group_info.expanded_nodes_r[rankid + 1])\n          group_info.expanded_nodes_r[rankid + 1] = [];\n\n        if (\n          obj.children &&\n          obj.children.length &&\n          (obj.expanded || obj.expanded_l || obj.expanded_r)\n        ) {\n          var children_l = [],\n            children_r = [];\n          obj.children.forEach((item) => {\n            if (item.direction === -1) children_l.push(item);\n            if (item.direction === 1) children_r.push(item);\n          });\n          children_l.length &&\n            group_info.expanded_nodes_l[rankid + 1].push(children_l);\n          children_r.length &&\n            group_info.expanded_nodes_r[rankid + 1].push(children_r);\n\n          for (var j = 0; j < obj.children.length; j++) {\n            _rank(obj.children[j], rankid + 1);\n          }\n        } else {\n          // 没有展开的子元素，则给下一级加一个空元素 用来占位\n          if (obj.isRoot || (!obj.isRoot && obj.direction === -1))\n            group_info.expanded_nodes_l[rankid + 1].push({\n              isEmpty: true,\n              rank_index: rankid + 1,\n            });\n          if (obj.isRoot || (!obj.isRoot && obj.direction === 1))\n            group_info.expanded_nodes_r[rankid + 1].push({\n              isEmpty: true,\n              rank_index: rankid + 1,\n            });\n        }\n      })(t.nodes[i], 0);\n\n      group_info.expanded_nodes_l = group_info.expanded_nodes_l.slice(\n        0,\n        group_info.expanded_rank_max_l + 1\n      );\n      group_info.expanded_nodes_r = group_info.expanded_nodes_r.slice(\n        0,\n        group_info.expanded_rank_max_r + 1\n      );\n\n      t.nodes[i].group_info = group_info;\n    }\n  },\n  // 组的最大末级节点数\n  get_group_max_length() {\n    var t = this;\n    for (var i = 0; i < t.nodes.length; i++) {\n      var group_info = t.nodes[i].group_info;\n      // 对比左右两边的末级节点的高度，将最大值赋值给节点组高度\n      var node_length_l = qjm.util.flatArray(\n        group_info.expanded_nodes_l[group_info.expanded_nodes_l.length - 1]\n      ).length;\n      var node_length_r = qjm.util.flatArray(\n        group_info.expanded_nodes_r[group_info.expanded_nodes_r.length - 1]\n      ).length;\n\n      group_info.max_node_length = Math.max(node_length_l, node_length_r);\n      group_info.total_height =\n        group_info.max_node_length * t.opts.keyNode_h + (length - 1) * 20;\n      if (node_length_l >= node_length_r) {\n        group_info.max_side_direction = -1;\n      } else {\n        group_info.max_side_direction = 1;\n      }\n    }\n  },\n\n  _get_total_height() {\n    var t = this;\n    t.total_height = 0;\n    for (var i = 0; i < t.nodes.length; i++) {\n      t.total_max_node_length += t.nodes[i].group_info.max_node_length;\n      t.total_height += t.nodes[i].group_info.total_height;\n    }\n    var top = t.canvas_center.y - t.total_height / 2;\n    var bottom = t.canvas_center.y + t.total_height / 2;\n    for (var i = 0; i < t.nodes.length; i++) {\n      var group_info = t.nodes[i].group_info;\n\n      if (i > 0 && t.nodes[i - 1].group_info.top_y) {\n        group_info.top_y =\n          t.nodes[i - 1].group_info.top_y +\n          t.nodes[i - 1].group_info.total_height +\n          100;\n        group_info.center_pos = {\n          x: this.canvas_center.x,\n          y: group_info.top_y + group_info.total_height / 2,\n        };\n      } else {\n        group_info.top_y = top;\n        group_info.center_pos = {\n          x: this.canvas_center.x,\n          y: group_info.top_y + group_info.total_height / 2,\n        };\n      }\n    }\n  },\n  layout() {\n    var t = this;\n    t._get_total_height();\n    for (var i = 0; i < t.nodes.length; i++) {\n      var group = t.nodes[i];\n      var dir = group.group_info.max_side_direction;\n      var expanded_nodes_l = group.group_info.expanded_nodes_l;\n      var expanded_nodes_r = group.group_info.expanded_nodes_r;\n      // 比较左右两边的高度，值大则反向布局，值小的正向布局\n      // 左边\n      var rank_max_nodes_length_l = qjm.util.flatArray(\n        expanded_nodes_l[expanded_nodes_l.length - 1]\n      );\n      // 右边\n      var rank_max_nodes_length_r = qjm.util.flatArray(\n        expanded_nodes_r[expanded_nodes_r.length - 1]\n      );\n      if (rank_max_nodes_length_l > rank_max_nodes_length_r) {\n        t._layout_backward(expanded_nodes_l, -1, group.group_info.center_pos);\n        t._layout_forward(expanded_nodes_r, 1, group.group_info.center_pos);\n      } else {\n        t._layout_backward(expanded_nodes_r, 1, group.group_info.center_pos);\n        t._layout_forward(expanded_nodes_l, -1, group.group_info.center_pos);\n      }\n    }\n  },\n\n  // 反向推定位：从末级节点向根节点推定位\n  _layout_backward(expanded_nodes, dir, group_center_pos) {\n    // 末级\n    var expanded_rank_max = expanded_nodes.length - 1;\n    var rank_max_nodes = qjm.util.flatArray(\n      expanded_nodes[expanded_rank_max]\n    );\n    let rank_max_nodes_total_height =\n      rank_max_nodes.length * this.opts.keyNode_h +\n      (rank_max_nodes.length - 1) * 20;\n\n    let top_h =\n      group_center_pos.y -\n      rank_max_nodes_total_height / 2 +\n      this.opts.keyNode_h / 2;\n\n    for (var i = 0; i < rank_max_nodes.length; i++) {\n      rank_max_nodes[i].x =\n        group_center_pos.x +\n        dir * expanded_rank_max * (this.opts.keyNode_w + 110);\n      rank_max_nodes[i].y = top_h + i * (this.opts.keyNode_h + 20);\n    }\n\n    // 前面级的节点\n    for (var i = expanded_nodes.length - 2; i >= 0; i--) {\n      var curr_rank_nodes = expanded_nodes[i]; //i为级数\n      var next_rank_nodes = expanded_nodes[i + 1]; //获取到后面那级的数据\n      var curr_rank_nodes_flat = qjm.util.flatArray(curr_rank_nodes);\n      for (var j = 0; j < curr_rank_nodes_flat.length; j++) {\n        var node = curr_rank_nodes_flat[j];\n        node.x = group_center_pos.x + dir * i * (this.opts.keyNode_w + 110);\n\n        if (\n          next_rank_nodes[j] instanceof Object &&\n          next_rank_nodes[j].isEmpty\n        ) {\n          node.y = next_rank_nodes[j].y;\n        } else {\n          var children = node.children.filter(\n            (item) => item.direction === dir\n          );\n          if (children.length) {\n            node.y = (children[0].y + children[children.length - 1].y) / 2;\n          }\n        }\n      }\n    }\n  },\n  // 正向推定位：从根级节点向末级推定位\n  _layout_forward(expanded_nodes, dir, group_center_pos) {\n    var y0 = expanded_nodes[0].y;\n    this._layout_backward(expanded_nodes, dir, group_center_pos);\n    var y1 = expanded_nodes[0].y;\n    var diff = y1 - y0;\n    for (var i = 0; i < expanded_nodes.length; i++) {\n      var curr_rank_nodes = expanded_nodes[i]; //i为级数\n      var curr_rank_nodes_flat = qjm.util.flatArray(curr_rank_nodes);\n      for (var j = 0; j < curr_rank_nodes_flat.length; j++) {\n        var node = curr_rank_nodes_flat[j];\n        if (!node.isEmpty) node.y -= diff;\n      }\n    }\n  },\n};\n\nexport default qjm;\n\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import QjMind from \"./src/mind\";\n\nexport default QjMind;"],"sourceRoot":""}